{% extends 'base.html.twig' %}

{% block title %}Contracts - EvoPlan{% endblock %}

{% block page_title %}Contracts{% endblock %}

{% block page_subtitle %}View and manage contract information{% endblock %}

{% block header_actions %}
    {# Removed "Add New Contract" button since contracts are created automatically with partnerships #}
{% endblock %}

{% block content %}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }} alert-icon mb-4" role="alert">
                <button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
                <div class="alert-icon-aside">
                    <i class="{% if label == 'success' %}far fa-check-circle{% else %}far fa-times-circle{% endif %}"></i>
                </div>
                <div class="alert-icon-content">
                    {{ message }}
                </div>
            </div>
        {% endfor %}
    {% endfor %}
    
    <div class="card mb-4">
        <div class="card-header">Contracts List</div>
        <div class="card-body">
            <table id="datatablesSimple">
                <thead>
                    <tr>
                        <th>Partner</th>
                        <th>Partnership</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for contract in contracts %}
                    <tr>
                        <td>{{ contract.idPartner ? contract.idPartner.email : 'N/A' }}</td>
                        <td>
                            {% if contract.idPartnership and contract.idPartnership.idEvent %}
                                {{ contract.idPartnership.idEvent.nom }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ contract.dateDebut ? contract.dateDebut|date('Y-m-d') : 'N/A' }}</td>
                        <td>{{ contract.dateFin ? contract.dateFin|date('Y-m-d') : 'N/A' }}</td>
                        <td>
                            <div class="badge bg-{{ 
                                contract.status == 'active' ? 'success' : 
                                (contract.status == 'suspended' ? 'warning' : 'danger') 
                            }}">
                                {{ contract.status|capitalize }}
                            </div>
                        </td>
                        <td>
                            <div class="d-flex">
                                <a href="{{ path('app_contract_show', {'id_contract': contract.id_contract}) }}" 
                                   class="btn btn-primary me-1">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ path('app_contract_edit', {'id_contract': contract.id_contract}) }}" 
                                   class="btn btn-warning me-1">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="#" 
                                   class="btn btn-danger"
                                   onclick="if(confirm('Are you sure you want to delete this contract?')) document.getElementById('delete-form-{{ contract.id_contract }}').submit();">
                                    <i class="fas fa-trash"></i>
                                </a>
                                <form id="delete-form-{{ contract.id_contract }}" method="post" action="{{ path('app_contract_delete', {'id_contract': contract.id_contract}) }}" style="display: none;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ contract.id_contract) }}">
                                </form>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" class="text-center">No contracts found</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        window.addEventListener('DOMContentLoaded', event => {
            feather.replace();
        });
    </script>
{% endblock %}
